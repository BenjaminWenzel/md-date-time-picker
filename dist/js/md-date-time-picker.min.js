"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),_dialog={view:!0,state:!1},mdDateTimePicker=function(){function t(e){var i=e.type,s=e.init,a=void 0===s?moment():s,d=e.past,l=void 0===d?moment().subtract(21,"years"):d,o=e.future,n=void 0===o?a:o,r=e.mode,c=void 0===r?!1:r,_=e.orientation,h=void 0===_?"LANDSCAPE":_;_classCallCheck(this,t),this._type=i,this._init=a,this._past=l,this._future=n,this._mode=c,this._orientation=h,this._sDialog={},document.getElementById("mddtp-picker__"+this._type)||this._buildDialog()}return _createClass(t,[{key:"time",value:function(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return""===t?this._init:void(this._init=t)}},{key:"toggle",value:function(){this._selectDialog(),t.dialog.state?this._hideDialog():("date"===this._type?this._initDateDialog(this._init):"time"===this._type&&this._initTimeDialog(this._init),this._showDialog())}},{key:"_selectDialog",value:function(){this._sDialog.picker=document.getElementById("mddtp-picker__"+[this._type]);for(var t=["viewHolder","years","header","cancel","ok","left","right","previous","current","next","subtitle","title","titleDay","titleMonth","AM","PM","needle","hourView","minuteView","hour","minute","fakeNeedle","circularHolder","circle"],e=t.length;e--;)this._sDialog[t[e]]=document.getElementById("mddtp-"+this._type+"__"+t[e]);this._sDialog.tDate=this._init.clone(),this._sDialog.sDate=this._init.clone()}},{key:"_showDialog",value:function(){var e=this;t.dialog.state=!0,this._sDialog.picker.classList.remove("mddtp-picker--inactive"),this._sDialog.picker.classList.add("zoomIn"),setTimeout(function(){e._sDialog.picker.classList.remove("zoomIn")},300)}},{key:"_hideDialog",value:function(){var e=this,i=this._sDialog.years,s=e._sDialog.title,a=e._sDialog.subtitle,d=this._sDialog.viewHolder,l=this._sDialog.AM,o=this._sDialog.PM,n=this._sDialog.minute,r=this._sDialog.hour,c=this._sDialog.minuteView,_=this._sDialog.hourView,h=this._sDialog.picker,p=this._sDialog.needle,m="mddtp-picker__color--active",u="mddtp-picker--inactive",g="mddtp-picker__years--invisible",v="zoomIn",f="zoomOut",D="mddtp-picker__circularView--hidden",k="mddtp-picker__selection";t.dialog.state=!1,t.dialog.view=!0,this._sDialog.picker.classList.add(f),"date"===this._type?(i.classList.remove(v,f),i.classList.add(g),s.classList.remove(m),a.classList.add(m),d.classList.remove(f)):(l.classList.remove(),o.classList.remove(m),n.classList.remove(m),r.classList.add(m),c.classList.add(D),_.classList.remove(D),a.setAttribute("style","display: none"),p.className="",p.classList.add(k)),setTimeout(function(){e._sDialog.picker.classList.remove(f),e._sDialog.picker.classList.add(u);var t=h.cloneNode(!0);h.parentNode.replaceChild(t,h)},300)}},{key:"_buildDialog",value:function(){var t=this._type,e=document.createDocumentFragment(),i=document.createElement("div"),s=document.createElement("div"),a=document.createElement("div"),d=document.createElement("div"),l=document.createElement("button"),o=document.createElement("button");if(i.id="mddtp-picker__"+t,i.classList.add("mddtp-picker","mddtp-picker-"+t,"mddtp-picker--inactive","animated"),this._addId(s,"header"),this._addClass(s,"header"),i.appendChild(s),this._addClass(a,"body"),a.appendChild(d),i.appendChild(a),"date"===this._type){var n=document.createElement("h4"),r=document.createElement("h2"),c=document.createElement("div"),_=document.createElement("div"),h=document.createElement("div"),p=document.createElement("ul"),m=document.createElement("li"),u=document.createElement("li"),g=document.createElement("li"),v=document.createElement("button"),f=document.createElement("button"),D=document.createElement("ul");this._addId(n,"subtitle"),this._addClass(n,"subtitle"),this._addId(r,"title"),this._addClass(r,"title",["mddtp-picker__color--active"]),this._addId(c,"titleDay"),this._addId(_,"titleMonth"),r.appendChild(c),r.appendChild(_),s.appendChild(n),s.appendChild(r),this._addId(h,"viewHolder"),this._addClass(h,"viewHolder",["animated"]),this._addClass(p,"views"),this._addId(m,"previous"),m.classList.add("mddtp-picker__view"),this._addId(u,"current"),u.classList.add("mddtp-picker__view"),this._addId(g,"next"),g.classList.add("mddtp-picker__view"),this._addView(m),this._addView(u),this._addView(g),h.appendChild(p),p.appendChild(m),p.appendChild(u),p.appendChild(g),this._addId(v,"left"),v.classList.add("mddtp-button"),this._addClass(v,"left"),v.setAttribute("type","button"),this._addId(f,"right"),f.classList.add("mddtp-button"),this._addClass(f,"right"),f.setAttribute("type","button"),this._addId(D,"years"),this._addClass(D,"years",["mddtp-picker__years--invisible","animated"]),a.appendChild(h),a.appendChild(v),a.appendChild(f),a.appendChild(D)}else{var k=document.createElement("h2"),C=document.createElement("span"),L=document.createElement("span"),y=document.createElement("span"),b=document.createElement("div"),w=document.createElement("div"),E=document.createElement("div"),I=document.createElement("div"),M=document.createElement("div"),T=document.createElement("span"),V=document.createElement("span"),x=document.createElement("span"),A=document.createElement("div"),H=document.createElement("div"),N=document.createElement("div");this._addId(k,"title"),this._addClass(k,"title"),this._addId(C,"hour"),C.classList.add("mddtp-picker__color--active"),L.textContent=":",this._addId(y,"minute"),this._addId(b,"subtitle"),this._addClass(b,"subtitle"),b.setAttribute("style","display: none"),this._addId(w,"AM"),w.textContent="AM",this._addId(E,"PM"),E.textContent="PM",k.appendChild(C),k.appendChild(L),k.appendChild(y),b.appendChild(w),b.appendChild(E),s.appendChild(k),s.appendChild(b),this._addId(I,"circularHolder"),this._addClass(I,"circularHolder"),this._addId(M,"needle"),M.classList.add("mddtp-picker__selection"),this._addClass(T,"dot"),this._addClass(V,"line"),this._addId(x,"circle"),this._addClass(x,"circle"),this._addId(A,"minuteView"),A.classList.add("mddtp-picker__circularView","mddtp-picker__circularView--hidden"),this._addId(H,"fakeNeedle"),H.classList.add("mddtp-picker__circle--fake"),this._addId(N,"hourView"),N.classList.add("mddtp-picker__circularView"),M.appendChild(T),M.appendChild(V),M.appendChild(x),I.appendChild(M),I.appendChild(A),I.appendChild(H),I.appendChild(N),a.appendChild(I)}d.classList.add("mddtp-picker__action"),this._addId(l,"cancel"),l.classList.add("mddtp-button"),l.setAttribute("type","button"),l.textContent="cancel",this._addId(o,"ok"),o.classList.add("mddtp-button"),o.setAttribute("type","button"),o.textContent="ok",d.appendChild(l),d.appendChild(o),a.appendChild(d),e.appendChild(i),document.getElementsByTagName("body").item(0).appendChild(e)}},{key:"_initTimeDialog",value:function(t){var e=this._sDialog.hour,i=this._sDialog.minute,s=this._sDialog.subtitle;this._mode?this._fillText(e,t.format("H")):(this._fillText(e,t.format("h")),this._sDialog[t.format("A")].classList.add("mddtp-picker__color--active"),s.removeAttribute("style")),this._fillText(i,t.format("mm")),this._initHour(),this._initMinute(),this._attachEventHandlers(),this._changeM(),this._dragDial(),this._switchToView(e),this._switchToView(i)}},{key:"_initHour",value:function(){var t=this._sDialog.hourView,e=this._sDialog.needle,i=document.createDocumentFragment();if(this._mode){parseInt(this._sDialog.tDate.format("H"),10)}else for(var s=parseInt(this._sDialog.tDate.format("h"),10),a=1,d=5;12>=a;a++,d+=5){var l=document.createElement("div"),o=document.createElement("span");l.classList.add("mddtp-picker__cell"),o.textContent=a,l.classList.add("mddtp-picker__cell--rotate-"+d),s===a&&(l.classList.add("mddtp-picker__cell--selected"),e.classList.add("mddtp-picker__cell--rotate-"+d)),l.appendChild(o),i.appendChild(l)}for(;t.lastChild;)t.removeChild(t.lastChild);t.appendChild(i)}},{key:"_initMinute",value:function(){for(var t=this._sDialog.minuteView,e=parseInt(this._sDialog.tDate.format("m"),10),i="mddtp-picker__cell--selected",s="mddtp-picker__cell--rotate-",a="mddtp-picker__cell",d=document.createDocumentFragment(),l=5,o=5;60>=l;l+=5,o+=5){var n=document.createElement("div"),r=document.createElement("span");n.classList.add(a),60===l?r.textContent=this._numWithZero(0):r.textContent=this._numWithZero(l),0===e&&(e=60),n.classList.add(s+o),(e===l||e-1===l||e+1===l||1===e&&60===l)&&n.classList.add(i),n.appendChild(r),d.appendChild(n)}for(;t.lastChild;)t.removeChild(t.lastChild);t.appendChild(d)}},{key:"_initDateDialog",value:function(t){var e=this._sDialog.subtitle,i=this._sDialog.title,s=this._sDialog.titleDay,a=this._sDialog.titleMonth;this._fillText(e,t.format("YYYY")),this._fillText(s,t.format("ddd, ")),this._fillText(a,t.format("MMM D")),this._initYear(),this._initViewHolder(),this._attachEventHandlers(),this._changeMonth(),this._switchToView(e),this._switchToView(i)}},{key:"_initViewHolder",value:function(){var t=this._sDialog.tDate,e=(this._sDialog.picker,this._sDialog.current),i=this._sDialog.previous,s=this._sDialog.next,a=this._past,d=this._future;t.isBefore(a,"month")&&(t=a.clone()),t.isAfter(d,"month")&&(t=d.clone()),this._sDialog.tDate=t,this._initMonth(e,t),this._initMonth(s,moment(this._getMonth(t,1))),this._initMonth(i,moment(this._getMonth(t,-1))),this._toMoveMonth()}},{key:"_initMonth",value:function(t,e){var i=e.format("MMMM YYYY");this._fillText(t.querySelector(".mddtp-picker__month"),i);var s=document.createDocumentFragment(),a=t.querySelector(".mddtp-picker__tr"),d=parseInt(moment(e).date(1).day(),10),l=-1,o=-1,n=parseInt(moment(e).endOf("month").format("D"),10)+d-1,r=d,c=n;moment().isSame(e,"month")&&(l=parseInt(moment().format("D"),10),l+=d-1),this._past.isSame(e,"month")&&(r=parseInt(this._past.format("D"),10),r+=d-1),this._future.isSame(e,"month")&&(c=parseInt(this._future.format("D"),10),c+=d-1),this._sDialog.sDate.isSame(e,"month")&&(o=parseInt(moment(e).format("D"),10),o+=d-1);for(var _=0;42>_;_++){var h=document.createElement("span"),p=_-d+1;_>=d&&n>=_&&(_>c||r>_?h.classList.add("mddtp-picker__cell--disabled"):h.classList.add("mddtp-picker__cell"),this._fillText(h,p)),l===_&&h.classList.add("mddtp-picker__cell--today"),o===_&&h.classList.add("mddtp-picker__cell--selected"),s.appendChild(h)}for(;a.lastChild;)a.removeChild(a.lastChild);a.appendChild(s),this._addCellClickEvent(a)}},{key:"_initYear",value:function(){for(var t=this._sDialog.years,e=this._sDialog.tDate.year(),i=document.createDocumentFragment(),s=this._past.year(),a=this._future.year(),d=s;a>=d;d++){var l=document.createElement("li");l.textContent=d,d===e&&(l.id="mddtp-date__currentYear",l.classList.add("mddtp-picker__li--current")),i.appendChild(l)}for(;t.lastChild;)t.removeChild(t.lastChild);t.appendChild(i),this._changeYear(t)}},{key:"_switchToView",value:function(t){var e=this;"date"==this._type?t.addEventListener("click",function(){e._switchToDateView(t,e)}):t.addEventListener("click",function(){e._switchToTimeView(t,e)})}},{key:"_switchToTimeView",value:function(e,i){var s=i._sDialog.hourView,a=i._sDialog.minuteView,d=i._sDialog.hour,l=i._sDialog.minute,o="mddtp-picker__color--active",n="mddtp-picker__circularView--hidden",r="mddtp-picker__selection",c=i._sDialog.needle,_=i._sDialog.circularHolder,h=i._sDialog.circle,p=i._sDialog.fakeNeedle,m=60,u=void 0;s.classList.toggle(n),a.classList.toggle(n),d.classList.toggle(o),l.classList.toggle(o),c.className="",c.classList.add(r),t.dialog.view?(u=i._sDialog.sDate.format("m"),setTimeout(function(){var t=_.getBoundingClientRect(),e=h.getBoundingClientRect();p.setAttribute("style","left:"+(e.left-t.left)+"px;top:"+(e.top-t.top)+"px")},300)):i._mode?(m=24,u=i._sDialog.sDate.format("H")):(m=12,u=i._sDialog.sDate.format("h"));var g=i._calcRotation(m,parseInt(u,10));g&&c.classList.add(g),t.dialog.view=!t.dialog.view}},{key:"_switchToDateView",value:function(e,i){e.setAttribute("disabled","");var s=i._sDialog.viewHolder,a=i._sDialog.years,d=i._sDialog.title,l=i._sDialog.subtitle,o=document.getElementById("mddtp-date__currentYear");t.dialog.view?(s.classList.add("zoomOut"),a.classList.remove("mddtp-picker__years--invisible"),a.classList.add("zoomIn"),o.scrollIntoViewIfNeeded()):(a.classList.add("zoomOut"),s.classList.remove("zoomOut"),s.classList.add("zoomIn"),setTimeout(function(){a.classList.remove("zoomIn","zoomOut"),a.classList.add("mddtp-picker__years--invisible"),s.classList.remove("zoomIn")},300)),d.classList.toggle("mddtp-picker__color--active"),l.classList.toggle("mddtp-picker__color--active"),t.dialog.view=!t.dialog.view,setTimeout(function(){e.removeAttribute("disabled")},300)}},{key:"_addCellClickEvent",value:function(t){var e=this;t.addEventListener("click",function(t){if(t.target&&"SPAN"==t.target.nodeName&&t.target.classList.contains("mddtp-picker__cell")){var i=e._sDialog.picker,s=t.target.textContent,a=e._sDialog.tDate.date(s),d=i.querySelector(".mddtp-picker__cell--selected"),l=e._sDialog.subtitle,o=e._sDialog.titleDay,n=e._sDialog.titleMonth;d&&d.classList.remove("mddtp-picker__cell--selected"),t.target.classList.add("mddtp-picker__cell--selected"),e._sDialog.sDate=a.clone(),this._fillText(l,a.year()),this._fillText(o,a.format("ddd, ")),this._fillText(n,a.format("MMM D"))}})}},{key:"_toMoveMonth",value:function(){var t=this._sDialog.tDate,e=this._sDialog.left,i=this._sDialog.right,s=this._past,a=this._future;e.removeAttribute("disabled"),i.removeAttribute("disabled"),e.classList.remove("mddtp-button--disabled"),i.classList.remove("mddtp-button--disabled"),t.isSame(s,"month")&&(e.setAttribute("disabled",""),e.classList.add("mddtp-button--disabled")),t.isSame(a,"month")&&(i.setAttribute("disabled",""),i.classList.add("mddtp-button--disabled"))}},{key:"_changeMonth",value:function(){function t(t,a){var d=!1,o=e._sDialog.next,n=e._sDialog.current,r=e._sDialog.previous;i.setAttribute("disabled",""),s.setAttribute("disabled",""),n.classList.add(t),r.classList.add(t),o.classList.add(t);var c=a.cloneNode(!0),_=void 0;a===o?(_=r,n.parentNode.appendChild(c),o.id=n.id,n.id=r.id,r=n,n=o,o=c):(d=!0,_=o,r.id=n.id,n.id=o.id,o=n,n=r),setTimeout(function(){a===r&&(n.parentNode.insertBefore(c,n),r=c),e._sDialog.next=o,e._sDialog.current=n,e._sDialog.previous=r,n.classList.add(l),o.classList.add(l),r.classList.add(l),n.classList.remove(t),o.classList.remove(t),r.classList.remove(t),_.parentNode.removeChild(_)},300),setTimeout(function(){n.classList.remove(l),o.classList.remove(l),r.classList.remove(l),d?e._sDialog.tDate=e._getMonth(e._sDialog.tDate,-1):e._sDialog.tDate=e._getMonth(e._sDialog.tDate,1),e._initViewHolder()},350),setTimeout(function(){i.classList.contains("mddtp-button--disabled")||i.removeAttribute("disabled"),s.classList.contains("mddtp-button--disabled")||s.removeAttribute("disabled")},400)}var e=this,i=this._sDialog.left,s=this._sDialog.right,a="mddtp-picker__view--left",d="mddtp-picker__view--right",l="mddtp-picker__view--pause";i.addEventListener("click",function(){t(d,e._sDialog.previous)}),s.addEventListener("click",function(){t(a,e._sDialog.next)})}},{key:"_changeYear",value:function(t){var e=this;t.addEventListener("click",function(i){if(i.target&&"LI"==i.target.nodeName){var s=document.getElementById("mddtp-date__currentYear");s.id="",s.classList.remove("mddtp-picker__li--current"),i.target.id="mddtp-date__currentYear",i.target.classList.add("mddtp-picker__li--current"),e._switchToDateView(t,e),e._sDialog.tDate.year(parseInt(i.target.textContent,10)),e._initViewHolder()}})}},{key:"_changeM",value:function(){var t=this,e=this._sDialog.AM,i=this._sDialog.PM;e.addEventListener("click",function(s){var a=t._sDialog.sDate.format("A");"PM"===a&&(t._sDialog.sDate.subtract(12,"h"),e.classList.toggle("mddtp-picker__color--active"),i.classList.toggle("mddtp-picker__color--active"))}),i.addEventListener("click",function(s){var a=t._sDialog.sDate.format("A");"AM"===a&&(t._sDialog.sDate.add(12,"h"),e.classList.toggle("mddtp-picker__color--active"),i.classList.toggle("mddtp-picker__color--active"))})}},{key:"_dragDial",value:function(){var t=this,e=this._sDialog.needle,i=this._sDialog.circle,s=this._sDialog.fakeNeedle,a=this._sDialog.circularHolder,d=this._sDialog.minute,l="mddtp-picker__selection--quick",o="mddtp-picker__selection",n="mddtp-picker__cell--selected",r="mddtp-picker__cell--rotate-",c=a.getBoundingClientRect(),_=void 0,h=new Draggabilly(s,{containment:!0});h.on("pointerDown",function(){c=a.getBoundingClientRect()}),h.on("dragMove",function(t){var i=t.clientX-c.left-c.width/2,s=t.clientY-c.top-c.height/2,a=Math.atan2(-s,i);e.className="",0>a&&(a+=2*Math.PI),a*=180/Math.PI,a=360-a,a>270&&(a-=360),_=parseInt(a/6);var d=Math.abs(6*_-a),n=Math.abs(6*(_+1)-a);d>n&&_++,_+=15,e.classList.add(o,l,r+_)}),h.on("dragEnd",function(){var a=t._sDialog.minuteView.getElementsByTagName("div"),o=parseInt(t._sDialog.sDate.format("m"),10),r=i.getBoundingClientRect();s.setAttribute("style","left:"+(r.left-c.left)+"px;top:"+(r.top-c.top)+"px"),e.classList.remove(l);var h=_;1===h&&(h=60),h=t._nearestDivisor(h,5),60===_&&(_=0),o>=0&&1>=o&&(o=60),o=t._nearestDivisor(o,5),o%5===0&&(o/=5,o--,a[o].classList.remove(n)),h>0&&(h/=5,h--,a[h].classList.add(n)),d.textContent=t._numWithZero(_),t._sDialog.sDate.minutes(_)})}},{key:"_attachEventHandlers",value:function(){var t=this,e=this._sDialog.ok,i=this._sDialog.cancel;i.addEventListener("click",function(){t.toggle()}),e.addEventListener("click",function(){t._init=t._sDialog.sDate,t.toggle()})}},{key:"_getMonth",value:function(t,e){var i=void 0;return i=t.clone(),e>0?i.add(Math.abs(e),"M"):i.subtract(Math.abs(e),"M")}},{key:"_nearestDivisor",value:function(t,e){return t%e===0?t:(t-1)%e===0?t-1:(t+1)%e===0?t+1:-1}},{key:"_numWithZero",value:function(t){return t>9?""+t:"0"+t}},{key:"_fillText",value:function(t,e){t.firstChild?t.firstChild.nodeValue=e:t.appendChild(document.createTextNode(e))}},{key:"_addId",value:function(t,e){t.id="mddtp-"+this._type+"__"+e}},{key:"_addClass",value:function(t,e,i){t.classList.add("mddtp-picker__"+e);var s=0;for(i&&(s=i.length,i.reverse());s--;)t.classList.add(i[s])}},{key:"_addView",value:function(t){for(var e=document.createElement("div"),i=document.createElement("div"),s=document.createElement("div"),a=document.createElement("div"),d=["S","F","T","W","T","M","S"],l=6;l--;){var o=document.createElement("span");o.textContent=d[l],s.appendChild(o)}this._addClass(e,"month"),this._addClass(i,"grid"),this._addClass(s,"th"),this._addClass(a,"tr"),t.appendChild(e),t.appendChild(i),i.appendChild(s),i.appendChild(a)}},{key:"_calcRotation",value:function(t,e){return 12===t?e*=5:24===t&&(e*=10),60===t&&0===e&&(e=60),"mddtp-picker__cell--rotate-"+e}}],[{key:"dialog",get:function(){return _dialog}}]),t}();Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(t){t=0===arguments.length?!0:!!t;var e=this.parentNode,i=window.getComputedStyle(e,null),s=parseInt(i.getPropertyValue("border-top-width"),10),a=parseInt(i.getPropertyValue("border-left-width"),10),d=this.offsetTop-e.offsetTop<e.scrollTop,l=this.offsetTop-e.offsetTop+this.clientHeight-s>e.scrollTop+e.clientHeight,o=this.offsetLeft-e.offsetLeft<e.scrollLeft,n=this.offsetLeft-e.offsetLeft+this.clientWidth-a>e.scrollLeft+e.clientWidth,r=d&&!l;(d||l)&&t&&(e.scrollTop=this.offsetTop-e.offsetTop-e.clientHeight/2-s+this.clientHeight/2),(o||n)&&t&&(e.scrollLeft=this.offsetLeft-e.offsetLeft-e.clientWidth/2-a+this.clientWidth/2),(d||l||o||n)&&!t&&this.scrollIntoView(r)}),Object.defineProperty&&Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(Element.prototype,"textContent")&&!Object.getOwnPropertyDescriptor(Element.prototype,"textContent").get&&!function(){var t=Object.getOwnPropertyDescriptor(Element.prototype,"innerText");Object.defineProperty(Element.prototype,"textContent",{get:function(){return t.get.call(this)},set:function(e){return t.set.call(this,e)}})}();